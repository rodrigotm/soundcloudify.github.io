!function(a){"use strict";var b=function(){function a(a){var c=b(a.title);return""===c.artist&&(c.track=a.title,c.artist="soundcloudify"),c}function b(a){var b="",e="",f=c(a);return null==f?{artist:"",track:""}:(b=a.substr(0,f.index),e=a.substr(f.index+f.length),d(b,e))}function c(a){var b=[" - "," – ","-","–",":"];for(var c in b){var d=b[c],e=a.indexOf(d);if(e>-1)return{index:e,length:d.length}}return null}function d(a,b){return a=a.replace(/^\s+|\s+$/g,""),b=b.replace(/^\s+|\s+$/g,""),b=b.replace(/^\d+\.\s*/,""),b=b.replace(/\s*\*+\s?\S+\s?\*+$/,""),b=b.replace(/\s*\[[^\]]+\]$/,""),b=b.replace(/\s*\([^\)]*version\)$/i,""),b=b.replace(/\s*\.(avi|wmv|mpg|mpeg|flv)$/i,""),b=b.replace(/\s*(of+icial\s*)?(music\s*)?video/i,""),b=b.replace(/\s*\(\s*of+icial\s*\)/i,""),b=b.replace(/\s*\(\s*[0-9]{4}\s*\)/i,""),b=b.replace(/\s+\(\s*(HD|HQ)\s*\)$/,""),b=b.replace(/\s+(HD|HQ)\s*$/,""),b=b.replace(/\s*video\s*clip/i,""),b=b.replace(/\s+\(?live\)?$/i,""),b=b.replace(/\(\s*\)/,""),b=b.replace(/^(|.*\s)"(.*)"(\s.*|)$/,"$2"),b=b.replace(/^(|.*\s)'(.*)'(\s.*|)$/,"$2"),b=b.replace(/^[\/\s,:;~-]+/,""),b=b.replace(/[\/\s,:;~-]+$/,""),{artist:a,track:b}}return{parse:a}}();window.LastFM=function(){function c(){l=localStorage.getItem("lastfm.sessionKey")}function d(a,c,d){var e=b.parse(a),f={method:"track.getInfo",track:e.track,artist:e.artist,api_key:j};h("GET",f,!0,c,d)}function e(a,b,c){if(!l)return void console.log("LastFM: no sessionKey");var d={method:"track.updatenowplaying",track:a.track,artist:a.artist,api_key:j,sk:l};h("POST",d,!0,b,c)}function f(a,b,c){if(!l)return void console.log("LastFM: no sessionKey");var d={method:"track.scrobble","timestamp[0]":a.startTimestamp,"track[0]":a.track,"artist[0]":a.artist,api_key:j,sk:l};h("POST",d,!0,b,c)}function g(a){var b=[],c="";for(var d in a)a.hasOwnProperty(d)&&b.push(d);b.sort();for(var e=0;e<b.length;e++)"format"!=b[e]&&"callback"!=b[e]&&(c=c+b[e]+a[b[e]]);return md5(c+k)}function h(b,c,d,e,f){c.api_key=j,d&&(c.api_sig=g(c)),c.format="json";var h=[];for(var k in c)c.hasOwnProperty(k)&&h.push(k+"="+encodeURIComponent(c[k]));var l=i+"?"+h.join("&");"GET"===b?a.get(l).done(e).fail(f):"POST"===b?a.post(l).done(e).fail(f):console.error("Unknown method: "+b)}var i="https://ws.audioscrobbler.com/2.0/",j="270d7aec2d7de22c88d90f36c66c9a1a",k="c8a7d4cbfba61e6b777220878bfa8cc1",l=localStorage.getItem("lastfm.sessionKey");return{onAuthSuccess:c,checkTrackInfo:d,updateNowPlaying:e,scrobble:f}}()}(jQuery),window.TrackItem=React.createClass({displayName:"TrackItem",onClick:function(){this.props.onTrackClick&&this.props.onTrackClick(this.props.track,this.props.trackNumber-1)},onPlayNext:function(){this.props.onPlayNext&&this.props.onPlayNext(this.props.track)},onAddTrackToPlaylist:function(){this.props.onAddTrackToPlaylist&&this.props.onAddTrackToPlaylist(this.props.track)},onRemoveTrack:function(){this.props.onRemoveTrack&&this.props.onRemoveTrack(this.props.track)},onStarTrack:function(){this.props.onStarTrack&&this.props.onStarTrack(this.props.track)},render:function(){var a=this.props.track,b=this.props.context||"nowplaying";if(a){var c,d,e,f,g={sc:"brand-icon icon-soundcloud",yt:"brand-icon icon ion-social-youtube-outline"};("nowplaying"===b||"playlist"===b)&&(c=React.createElement("i",{className:"remove-btn icon ion-close",onClick:this.onRemoveTrack,title:"Remove"})),"nowplaying"!==b&&(d=React.createElement("i",{className:"add-to-playlist-btn icon ion-log-in",title:"Play Next",onClick:this.onPlayNext})),a.starred?e=React.createElement("div",{className:"starred"},React.createElement("i",{className:"remove-btn icon ion-star",title:"Remove Star",onClick:this.onStarTrack})):f=React.createElement("i",{className:"like-btn icon ion-star",title:"Star",onClick:this.onStarTrack});var h="track-item";return a.error&&(h+=" error"),React.createElement("li",{id:"track-item-"+a.id,className:h},React.createElement("div",{className:"md-tile-left",onClick:this.onClick},React.createElement("div",{className:"face"},React.createElement("img",{src:a.artworkUrl,alt:a.title}))),React.createElement("div",{className:"play-actions",onClick:this.onClick},React.createElement("span",{className:"track-number"},this.props.trackNumber),React.createElement("i",{className:"dynamic-icon icon icon-playing"}),React.createElement("i",{className:"dynamic-icon icon ion-ios-play"}),React.createElement("i",{className:"dynamic-icon icon ion-ios-pause"})),e,React.createElement("div",{className:"md-tile-content"},React.createElement("h3",{onClick:this.onClick},a.title),React.createElement("p",{className:"statistic"},React.createElement("a",{className:"original-link",href:a.originalUrl,title:"View Original"},React.createElement("i",{className:g[a.origin]})),React.createElement("i",{className:"icon ion-headphone"}),React.createElement("span",null,parseInt(a.viewCount).toLocaleString()),React.createElement("i",{className:"icon ion-heart"}),React.createElement("span",null,parseInt(a.likeCount).toLocaleString()))),React.createElement("div",{className:"md-tile-hover"},f,d,React.createElement("i",{className:"add-to-playlist-btn icon ion-plus",title:"Add to playlist",onClick:this.onAddTrackToPlaylist}),c))}}}),window.TrackList=React.createClass({displayName:"TrackList",propTypes:{tracks:React.PropTypes.array,trackClick:React.PropTypes.string,onTrackClick:React.PropTypes.func,onPlayNext:React.PropTypes.func,onAddTrackToPlaylist:React.PropTypes.func,onStarTrack:React.PropTypes.func,onRemoveTrack:React.PropTypes.func,componentDidUpdate:React.PropTypes.func,listContext:React.PropTypes.string},render:function(){var a=this.props.tracks,b=this.props.onTrackClick,c=this.props.onAddTrackToPlaylist,d=this.props.onRemoveTrack,e=this.props.onStarTrack,f=this.props.onPlayNext,g=this.props.listContext,h=0,i=_.map(a,function(a){return h++,a?React.createElement(TrackItem,{context:g,key:a.uuid,track:a,trackNumber:h,player:player,onTrackClick:b,onAddTrackToPlaylist:c,onRemoveTrack:d,onStarTrack:e,onPlayNext:f}):void 0});return React.createElement("ul",{className:"media-list"},i)},componentDidUpdate:function(){this.props.componentDidUpdate&&this.props.componentDidUpdate()}}),function(){"use strict";window.ServiceHelpers=window.ServiceHelpers||{},window.ServiceHelpers.appendTransform=function(a,b){return a=angular.isArray(a)?a:[a],a.concat(b)},window.ServiceHelpers.buildUrl=function(a,b){var c=[];for(var d in b)b.hasOwnProperty(d)&&c.push(d+"="+encodeURIComponent(b[d]));return a+"?"+c.join("&")},window.ServiceHelpers.ID=function(){return"_"+Math.random().toString(36).substr(2,9)};var a=angular.module("soundCloudify",["ngMaterial","ngRoute","ui.router","react","indexedDB"]);a.value("API_ENDPOINT","http://api.getsoundcloudify.com"),a.value("CLIENT_ID","849e84ac5f7843ce1cbc0e004ae4fb69"),a.config(["$stateProvider","$urlRouterProvider","$mdThemingProvider","$compileProvider","$httpProvider","$indexedDBProvider",function(a,b,c,d,e,f){a.state("nowPlaying",{url:"/now-playing",templateUrl:"partials/nowPlaying.html",controller:"NowPlayingController",controllerAs:"vm"}).state("search",{url:"/search",templateUrl:"partials/search.html",controller:"SearchController"}).state("playlist",{"abstract":!0,url:"/playlist",templateUrl:"partials/playlist/playlist.html",controller:"PlaylistController",controllerAs:"playlistCtrl"}).state("playlist.list",{url:"",templateUrl:"partials/playlist/list.html"}).state("playlist.view",{url:"/:playlistIndex",templateUrl:"partials/playlist/view.html",controller:"PlaylistViewController",controllerAs:"playlistViewCtrl"}).state("charts",{"abstract":!0,url:"/charts",templateUrl:"partials/charts/charts.html",controller:"ChartsController",controllerAs:"chartsCtrl"}).state("charts.list",{url:"",templateUrl:"partials/charts/list.html"}).state("charts.detail",{url:"/:category",templateUrl:"partials/charts/view.html",controller:"ChartsViewController",controllerAs:"viewCtrl"}),b.otherwise("/charts"),c.definePalette("amazingPaletteName",{50:"ffebee",100:"ffcdd2",200:"ef9a9a",300:"e57373",400:"ef5350",500:"f44336",600:"e53935",700:"d32f2f",800:"c62828",900:"b71c1c",A100:"ff8a80",A200:"ff5252",A400:"ff1744",A700:"d50000",contrastDefaultColor:"light",contrastDarkColors:["50","100","200","300","400","A100"],contrastLightColors:void 0}),c.theme("default").primaryPalette("light-green").dark(),d.imgSrcSanitizationWhitelist(/^\s*((https?|ftp|file|blob|chrome-extension):|data:image\/)/),e.interceptors.push("HttpRequestInterceptor"),f.connection("soundcloudify").upgradeDatabase(1,function(a,b,c){console.log("upgradeDatabase");var d=b.createObjectStore("playlist",{keyPath:"uuid"});d.createIndex("sync","sync",{unique:!1}),d.createIndex("deleted","deleted",{unique:!1});var e=b.createObjectStore("nowplaying",{keyPath:"uuid"});e.createIndex("sync","sync",{unique:!1}),e.createIndex("deleted","deleted",{unique:!1});var f=b.createObjectStore("starred",{keyPath:"id"});f.createIndex("sync","sync",{unique:!1}),f.createIndex("deleted","deleted",{unique:!1})}),d.debugInfoEnabled(!1)}]),a.run(["$rootScope","GATracker","$location","SyncService","$window",function(a,b,c,d,e){a.$on("$stateChangeSuccess",function(a){b.trackPageView(c.path())}),d.init(),e.onSignIn=function(b){var c=b.getBasicProfile();console.log("sign in success"),a.$broadcast("identity.confirm",{identity:{email:c.getEmail(),id:c.getId(),image:c.getImageUrl(),name:c.getName()}})}}]),angular.element(document).ready(function(){setTimeout(function(){angular.bootstrap(document,["soundCloudify"])},100)})}(),function(){function a(a,b,c){var d=this;this.isLoading=!0,this.getCategories=function(){var b={limit:10,offset:0,linked_partitioning:1,client_id:c};a.get("https://api-v2.soundcloud.com/explore/categories",{params:b}).success(function(a){d.categories=a.music,d.selectedCategory=d.categories[0],d.isLoading=!1})},this.start=function(){b.path("/playlist/"+d.selectedCategory)},this.getCategories()}soundCloudify=angular.module("soundCloudify"),soundCloudify.controller("MainController",["$http","$location","CLIENT_ID",a])}(),function(){function a(a,b,c,d){var e=this,f=["nowPlaying","search","playlist.list","charts.list"],g=(localStorage,parseInt(localStorage.getItem("activeTab")));e.selectedIndex=isNaN(g)?3:g,e.onTabSelect=function(){d(function(){localStorage.setItem("activeTab",e.selectedIndex),c.go(f[e.selectedIndex])})}}angular.module("soundCloudify").controller("DiscoveryController",a),a.$inject=["$scope","$mdSidenav","$state","$timeout"]}(),function(){function a(a,b,c,d,e,f,g){var h=this;h.playlists=d.getList(),h.starredListLength=e.getLength(),c.$on("starredList.ready",function(){h.starredListLength=e.getLength()}),h.newPlaylistName="",h.addNew=function(a){13===a.which&&h.newPlaylistName&&d.newPlaylist(h.newPlaylistName).then(function(){h.newPlaylistName="",g.trackPlaylist("add new")})},h.remove=function(a,b){a.stopPropagation(),d.removePlaylist(b),g.trackPlaylist("remove at",b)},h.playAll=function(b,c){b.stopPropagation();var e=d.getPlaylist(c);return e.tracks.length?(f.playAll(e.tracks),void g.trackPlaylist("play all",c)):void a.show(a.simple().content("No track to play").position("bottom right").parent(angular.element(document.querySelector("#tab-content"))).hideDelay(2e3))},h.selectPlaylist=function(a){b.go("playlist.view",{playlistIndex:a})}}angular.module("soundCloudify").controller("PlaylistController",a),a.$inject=["$mdToast","$state","$scope","PlaylistService","StarService","CorePlayer","GATracker"]}(),function(){function a(a,b,c,d){var e=this;if(e.playlistIndex=b.playlistIndex,!e.playlistIndex)throw new Error("PlaylistViewController: playlistIndex is undefined");if(e.playlistIndex>=0?(e.playlist=c.getPlaylist(e.playlistIndex),e.playlistTracks=_.filter(e.playlist.tracks,function(a){return!a.deleted})):(e.playlist={name:"Starred",tracks:[]},d.getTracks().then(function(a){e.playlistTracks=a})),!e.playlist)throw new Error("PlaylistViewController: playlist not found at index = "+e.playlistIndex);e.backToPlaylist=function(){a.go("playlist.list")}}angular.module("soundCloudify").controller("PlaylistViewController",a),a.$inject=["$state","$stateParams","PlaylistService","StarService"]}(),function(){function a(a,b,c){var d=this;a.getList().then(function(a){d.categories=a}),d.playAll=function(){c.$broadcast("charts.playAll")},d.selectCategory=function(a){b.go("charts.detail",{category:a})},d.selectReddit=function(){b.go("charts.detail",{category:"reddit"})},d.sanitizeCategory=function(a){return unescape(a).replace(/\+/g," ")}}angular.module("soundCloudify").controller("ChartsController",a),a.$inject=["Category","$state","$scope"]}(),function(){function a(a,b,c,d,e,f,g,h){var i=this;if(i.category=d.category,!i.category)throw new Error("ChartsViewController: category is undefined");i.fallbackArtwork="images/artwork-default.jpg",i.tracks=[],i.paginator=f.getInstance({limit:10,getFirstPage:!0,pagingFunction:function(a){return"reddit"===i.category?b.getRedditHot(a):b.getTracks(i.category,a)},pagingSuccess:function(a){i.tracks=i.tracks.concat(a)}}),i.paginator.moreRows(),i.backToTopChart=function(){c.go("charts.list")},a.$on("charts.playAll",function(){return h.trackDiscovery("play all",i.category),i.tracks.length?(e.playAll(i.tracks),void g.show(g.simple().content("All tracks has been addded to Now Playing list").position("bottom right").parent(angular.element(document.querySelector("#tab-content"))).hideDelay(2e3))):void g.show(g.simple().content("No track to play").position("bottom right").parent(angular.element(document.querySelector("#tab-content"))).hideDelay(2e3))})}angular.module("soundCloudify").controller("ChartsViewController",a),a.$inject=["$scope","Category","$state","$stateParams","CorePlayer","Paginator","$mdToast","GATracker"]}(),function(){function a(a,b,c,d,e,f,g,h){var i=this;i.player=f,i.loading=!0,i.tracks=[],a.$on("sync.completed",function(){e.getTracks().then(function(a){i.tracks=g.decorateStar(a),i.loading=!1})}),e.getTracks().then(function(a){i.tracks=g.decorateStar(a),i.loading=!1}),i.saveStream=function(a){function b(a){function b(a,b,c){a.newPlaylistName="",a.addNew=function(a){},a.createPlaylist=function(){if(a.newPlaylistName){d.newPlaylist(a.newPlaylistName,!0,i.tracks).then(function(){a.newPlaylistName="",b.hide()})}},a.cancel=function(){b.hide()}}var e=angular.element(document.body);c.show({parent:e,targetEvent:a,template:'<md-dialog aria-label="List dialog">  <md-content>    <md-input-container>      <label>New Playlist</label>      <input ng-model="newPlaylistName" type="text" placeholder="Enter playlist name">    </md-input-container>  </md-content>  <div class="md-actions">    <md-button ng-click="cancel()">      Cancel    </md-button>    <md-button class="md-primary" ng-click="createPlaylist()">      Create Playlist    </md-button>  </div></md-dialog>',locals:{player:i.player},controller:b}),b.$inject=["scope","$mdDialog","player"]}b(a)},i.clearStream=function(a){var b=c.confirm().title("Would you like clear the current stream?").content("Tips: You might want to save it as a playlist").ok("Please do it!").cancel("No, I don't").targetEvent(a);c.show(b).then(function(){i.tracks=[],i.player.clear()},function(){})}}angular.module("soundCloudify").controller("NowPlayingController",a),a.$inject=["$scope","Category","$mdDialog","PlaylistService","NowPlaying","CorePlayer","TrackAdapter","$timeout"]}(),function(){function a(a,b){a.vm=b,a.$watch("vm.toggle",function(b,c){a.vm.onToggled(b,c)},!0),a.$watch("vm.search.term",function(b,c){b||a.vm.resetSearch()},!0)}angular.module("soundCloudify").controller("SearchController",a),a.$inject=["$scope","SearchSingleton"]}(),function(){"use strict";function a(a,b,c){return{restrict:"E",templateUrl:"scripts/views/player.html",link:function(d,e,f){d.player=a,d.volume=100*d.player.state.volume,d.openManualScrobble=function(d){function e(a,b,c,d){a.close=function(){b.hide()},a.$on("lastfm.scrobbled",function(){a.scrobbling=!1,b.hide()}),a.$on("lastfm.scrobbled",function(){a.scrobbling=!1,a.error="Can not scrobble the track you enter"}),a.sendManualScrobble=function(){a.manualScrobble&&a.manualScrobble.track&&a.manualScrobble.artist&&(a.scrobbling=!0,c.sendManualScrobble(a.manualScrobble),d.trackCustomEvent("lastfm","send manual scrobble"))}}c.trackCustomEvent("lastfm","open manual scrobble"),a.state.scrobble&&!a.state.currentTrack.scrobbled&&a.state.currentTrack.lastFmValidate===!1&&(b.show({parent:angular.element(document.body),targetEvent:d,templateUrl:"scripts/views/manualScrobble.html",controller:e}),e.$inject=["scope","$mdDialog","CorePlayer","GATracker"])},d.doSeek=function(b){var c=b.offsetX/b.target.offsetWidth;a.seek(c)},d.getScrobbleTitle=function(){return a.state.scrobble?a.state.currentTrack.lastFmValidate===!1?"track unregconized by last.fm, right click to edit":a.state.currentTrack.scrobbled?"track has been scrobbled":"last.fm scrobble":"last.fm scrobble"},d.$watch("volume",function(a){a&&d.player.setVolume(a/100)})}}}angular.module("soundCloudify").directive("scdPlayer",a),a.$inject=["CorePlayer","$mdDialog","GATracker"]}(),function(){"use strict";function a(){var a=function(a){a.ver=a.variation||4};return{restrict:"E",scope:{variation:"@"},templateUrl:"scripts/views/loadingDirective.html",link:function(b){a(b)}}}var b=angular.module("soundCloudify");b.directive("loading",a)}(),function(){"use strict";function a(a){return{restrict:"EA",transclude:!0,template:'<div class="moving-title" ng-transclude></div>',link:function(b,c,d){function e(){l=!1,i.remove(),c[0].style.marginLeft=0}function f(){l&&k>m?(a(f,30),c[0].style.marginLeft=-m+"px",m++):e()}var g,h,i,j,k,l,m;d.$observe("trackTitle",function(a){l&&e()}),c.on("mouseover",function(a){l||(g=c[0].querySelector(".moving-title"),h=g.querySelector("span"),j=g.offsetWidth,k=h.offsetWidth,l=!1,m=0,k>j&&(l=!0,h.style.marginRight="10px",k+=10,i=h.cloneNode(!0),g.appendChild(i),f()))})}}}angular.module("soundCloudify").directive("trackTitle",a),a.$inject=["$timeout"]}(),function(){"use strict";function a(){return{restrict:"A",link:function(a,b,c){var d="md-primary";c.$observe("toggleButton",function(a){"true"===a?b.addClass(d):b.removeClass(d)}),b.on("click",function(){b.toggleClass(d)})}}}angular.module("soundCloudify").directive("toggleButton",a)}(),function(){"use strict";function a(a,b,c){return{restrict:"E",templateUrl:"scripts/views/playlist-menu.html",controller:["$scope","PlaylistService",function(b,d){b.playlists=d.getList(),b.newPlaylistName="",b.addNew=function(a){13===a.which&&b.newPlaylistName&&(d.newPlaylist(b.newPlaylistName),b.newPlaylistName="")},b.remove=function(a){d.removePlaylist(a)},b.addTrackToPlaylist=function(b){if(!a.trackToAdd)throw new Error("No track to add");d.addTrackToPlaylist(a.trackToAdd,b),a.$emit("playlist.menu.close"),c.show(c.simple().content("Track has been added to playlist successfully").position("bottom right").hideDelay(1e3).parent(angular.element(document.querySelector("#tab-content"))))}}]}}function b(a,b){function c(a){h=a.element;var b=a.trackToAdd;if(!h)throw new Error("Element is missing when open playlist menu");if(!b)throw new Error("trackToAdd is missing when open playlist menu");d(b)}function d(b){g=angular.element('<md-backdrop class="md-dialog-backdrop md-opaque md-default-theme">'),angular.element(document).find("body").append(g),g.on("click",e),i.addClass("open");var c=f();i.css("top",c.top+"px"),i.css("left",c.left+"px"),j=!0,h.parent().addClass("active"),a.trackToAdd=b}function e(){i.removeClass("open"),g.remove(),j=!1,h.parent().removeClass("active")}function f(){var a="",c=b[0].documentElement.getBoundingClientRect(),d=h[0].getBoundingClientRect(),e=i[0].getBoundingClientRect(),f=e.width,g=e.height;a+=d.top-g>=0?"top":"bottom",a+=d.left+d.width+f>c.width?"left":"right";var j=0,k=0;switch(a){case"topleft":j=d.top-g,k=d.left-f;break;case"topright":j=d.top-g,k=d.left+d.width;break;case"bottomleft":j=d.top+d.height,k=d.left-f,j+g>c.height&&(j-=j+g-c.height+10);break;case"bottomright":j=d.top+d.height,k=d.left+d.width,j+g>c.height&&(j-=j+g-c.height+10)}return{top:j,left:k}}var g,h,i=angular.element(document.getElementById("singleton-playlist-menu")),j=!1;return a.$on("playlist.menu.close",function(){j&&e()}),{show:c}}angular.module("soundCloudify").directive("playlistMenu",a).service("$playlistMenu",b),a.$inject=["$rootScope","PlaylistService","$mdToast"],b.$inject=["$rootScope","$document"]}(),function(){"use strict";function a(a){return a("TrackList")}function b(a,b,c,d,e,f,g){return{restrict:"E",templateUrl:"scripts/views/trackList.html",scope:{tracks:"=",trackClick:"&",onTrackClick:"@",listContext:"@",listIndex:"@"},link:function(d,h,i){d.onTrackClick=d.onTrackClick||"playnow",d.componentDidUpdate=function(){d.$emit("componentDidUpdate")},d.showPlaylistMenu=function(b){var c=angular.element(h[0].querySelector("#track-item-"+b.id+" .add-to-playlist-btn"));a.show({element:c,trackToAdd:b}),g.trackDiscovery("add to playlist",d.listContext)},d.handleTrackClick=function(a,c){if("playpause"===d.onTrackClick){if(isNaN(c))throw new Error('track index is not specify or not a number for "playpause"');b.playPause(c),g.trackDiscovery("play - pause",d.listContext)}else if(d.onTrackClick="playnow"){if(!a)throw new Error("trying to add track, but no track to add");b.add(a,!0),g.trackDiscovery("add track",d.listContext)}},d.playNext=function(a){b.playNext(a),g.trackDiscovery("up next",d.listContext),f.show(f.simple().content("Track has been queued up next").position("bottom right").parent(angular.element(document.querySelector("#tab-content"))).hideDelay(1e3))},d.handleRemoveTrack=function(a){var e=_.findIndex(d.tracks,function(b){return b.uuid===a.uuid});if("nowplaying"===d.listContext)d.tracks.splice(e,1),b.remove(e);else if("playlist"===d.listContext){if(!d.listIndex)throw new Error("list index undefined");d.tracks.splice(e,1),c.removeTrackFromPlaylist(e,d.listIndex)}g.trackDiscovery("remove track",d.listContext)},d.starTrack=function(a){a.starred=!a.starred,a.starred?g.trackDiscovery("star track",d.listContext):g.trackDiscovery("unstar track",d.listContext),a.starred?e.starTrack(a):e.unstarTrack(a)}}}}angular.module("soundCloudify").directive("trackListReact",a).directive("trackList",b),a.$inject=["reactDirective"],b.$inject=["$playlistMenu","CorePlayer","PlaylistService","NowPlaying","StarService","$mdToast","GATracker"]}(),function(){"use strict";function a(a,b){return{restrict:"A",scope:{},transclude:!0,template:"<div ng-transclude></div>",link:function(a,c,d){function e(){var a=b.state.currentTrack,d=b.state.currentIndex;if(a){angular.element(c[0].querySelector(".playing, .pause")).removeClass("playing pause");var e="playing";b.state.playing||(e="pause"),"index"===f?angular.element(c[0].querySelectorAll(".track-item")[d]).addClass(e):angular.element(c[0].querySelector("#track-item-"+a.id)).addClass(e)}}a.player=b;var f=d.playingTrackAware;a.$on("componentDidUpdate",function(){e()}),a.$watch("player.state.currentTrack",function(){e()},!0),a.$watch("player.state.currentIndex",function(){e()},!0),a.$watch("player.state.playing",function(a){e()},!0)}}}angular.module("soundCloudify").directive("playingTrackAware",a),a.$inject=["$timeout","CorePlayer"]}(),function(){"use strict";function a(){return{restrict:"E",template:'<span><md-button title="about" ng-click="vm.showInformation($event)"><md-icon md-font-icon="icon ion-ios-information"></md-icon></md-button><md-button title="settings" ng-click="vm.openConfigurationDialog($event)"><md-icon md-font-icon="icon ion-gear-b"></md-icon></md-button></span>',scope:{},controller:b,controllerAs:"vm"}}function b(a){function b(b){function c(a,b){chrome.storage.sync.get("scConfig",function(b){a.configuration=b.scConfig||{showNotification:!0,scrobbleDuration:30}}),a.close=function(){b.hide()},a.save=function(){(!a.configuration.scrobbleDuration||isNaN(a.configuration.scrobbleDuration))&&(a.configuration.scrobbleDuration=30),chrome.storage.sync.set({scConfig:a.configuration}),b.hide()}}var d=angular.element(document.body);a.show({parent:d,targetEvent:b,templateUrl:"scripts/views/configuration.html",controller:c}),c.$inject=["scope","$mdDialog"]}function c(b){function c(a,b,c){a.close=function(){b.hide()}}var e=angular.element(document.body);a.show({parent:e,targetEvent:b,templateUrl:"scripts/views/info.html",locals:{player:d.player},controller:c}),c.$inject=["scope","$mdDialog","player"]}var d=this;d.openConfigurationDialog=function(a){b(a)},d.showInformation=function(a){c(a)}}angular.module("soundCloudify").directive("configuration",a),b.$inject=["$mdDialog"]}(),function(){"use strict";function a(a){return function(b,c,d){var e=a(d.rightClick);c.bind("contextmenu",function(a){b.$apply(function(){a.preventDefault(),e(b,{$event:a})})})}}angular.module("soundCloudify").directive("rightClick",a),a.$inject=["$parse"]}(),function(){"use strict";angular.module("soundCloudify").directive("googleSignin",["$window",function(a){return{restrict:"E",template:'<div class="goggle-signin"></div>',replace:!0,link:function(b,c,d,e){var f=document.createElement("script");f.type="text/javascript",f.async=!0,f.src="https://apis.google.com/js/platform.js";var g=document.getElementsByTagName("script")[0];g.parentNode.insertBefore(f,g),f.onload=function(){gapi.signin2.render(c[0],{scope:"email",width:190,longtitle:!0,theme:"dark",onsuccess:a.onSignIn,onfailure:function(a){console.log("failed to sign in")}})},b.$on("identity.confirm",function(){c.attr("style","display: none")})}}}])}(),function(){"use strict";function a(){var a=!0,b=10;this.setRowsCountPerPage=function(a){b=a},this.$get=[function(){var c=function(a,b){if(!this.isBusy()){var c=this;a="undefined"==typeof a?!1:a;var d=this.paginationModel;b&&(d=angular.copy(d),d.limit=b);var e=this.pagingFunction.call(void 0,d,a);if(!e||!e.then)throw new Error("pagingFunction should return a promise object");e.then(function(b){if(b){var e=b.nextPageToken||"",f=b.tracks;f&&f.length?(c.data=a?c.data.concat(f):f,c.paginationModel.skip+=f.length,c.paginationModel.nextPageToken=e,c.hasMoreRow=f.length===d.limit):c.hasMoreRow=!1,c.pagingSuccess.call(void 0,f,a)}},function(){c.pagingFailed.call(void 0)}),this.lastPromise=e}},d=function(a){if(a=a||{},!a.pagingFunction||"function"!=typeof a.pagingFunction)throw"pagingFunction has to be provided as an option when instantiate paginator";this.data=[],this.paginationModel={limit:a.limit||b,skip:a.skip||0,nextPageToken:""},this.hasMoreRow=!0,this.pagingFunction=a.pagingFunction,this.pagingSuccess="function"==typeof a.pagingSuccess?a.pagingSuccess:angular.noop,this.pagingFailed="function"==typeof a.pagingFailed?a.pagingFailed:angular.noop,a.fetchFirstPage&&c.call(this,!1)};return d.prototype={constructor:d,moreRows:function(){c.call(this,a)},sortBy:function(b){b===this.paginationModel.sort?this.paginationModel.direction=1==this.paginationModel.direction?-1:1:(this.paginationModel.direction=1,this.paginationModel.sort=b);var d;this.paginationModel.limit&&(d=this.paginationModel.skip),this.paginationModel.skip=0,c.call(this,!a,d)},isSortedBy:function(a){return a===this.paginationModel.sort?!0:!1},getSortDirection:function(){return this.paginationModel.direction},isBusy:function(){return this.lastPromise&&0===this.lastPromise.$$state.status},reset:function(){this.paginationModel.skip=0,this.paginationModel.nextPageToken=""}},{getInstance:function(a){return new d(a)}}}]}angular.module("soundCloudify").provider("Paginator",a)}(),function(){function a(){return function(a){return a?-1!==a.indexOf("-large")?a.replace("-large.","-t250x250."):-1!==a.indexOf("default.jpg")?a.replace("default.jpg","hqdefault.jpg"):a:""}}angular.module("soundCloudify").filter("scArtwork",a)}(),function(){function a(){return function(a){var b=Math.floor(a/3600),c="0"+Math.floor(a%3600/60),d="0"+Math.floor(a%60);return c=c.substr(c.length-2),d=d.substr(d.length-2),isNaN(d)?"00:00":b?b+":"+c+":"+d:c+":"+d}}angular.module("soundCloudify").filter("prettyTime",a)}(),function(){"use strict";function a(a,b){function c(){}function d(){}function e(){}function f(a){switch(a){case"playlist":return new c;case"nowplaying":return new d;case"starred":return new e}return null}return c.prototype={constructor:c,upsert:function(a){b.openStore("playlist",function(b){b.upsert(a)})},insert:function(a){b.openStore("playlist",function(b){b.insert(a)})},"delete":function(a){b.openStore("playlist",function(b){Array.isArray(a)?_.each(a,function(a){b["delete"](a)}):b["delete"](a)})},getAllPlaylists:function(){return a(function(a,c){b.openStore("playlist",function(b){var c=b.query();c.$index("deleted"),c.$eq(0),b.eachWhere(c).then(function(b){a(_.sortBy(b,"order").reverse())})})})},getUnsyncedPlaylists:function(){return a(function(a,c){b.openStore("playlist",function(b){var c=b.query();c.$index("sync"),c.$eq(0),b.eachWhere(c).then(function(b){a(b)})})})}},d.prototype={constructor:d,upsert:function(c){return a(function(a,d){b.openStore("nowplaying",function(b){_.each(c,function(a){b.upsert(a)}),a()})})},insert:function(c){return a(function(a,d){b.openStore("nowplaying",function(b){Array.isArray(c)?(_.each(c,function(a){b.insert(a)}),a()):(b.insert(c),a())})})},"delete":function(a){b.openStore("nowplaying",function(b){Array.isArray(a)?_.each(a,function(a){b["delete"](a)}):b["delete"](a)})},clear:function(){b.openStore("nowplaying",function(a){a.clear()})},getTracks:function(){return a(function(a,c){b.openStore("nowplaying",function(b){var c=b.query();c.$index("deleted"),c.$eq(0),b.eachWhere(c).then(function(b){a(_.sortBy(b,"order").reverse())})})})},getById:function(c){return a(function(a,d){b.openStore("nowplaying",function(b){b.find(c).then(function(b){a(b)})})})},increaseOrder:function(c){return a(function(a,d){b.openStore("nowplaying",function(b){_.each(c,function(a){b.find(a).then(function(a){a.order+=1,b.upsert(a)})}),a()})})},markAllTracksAsDeleted:function(){var b=this;return a(function(a,c){b.getTracks().then(function(c){_.each(c,function(a){a.deleted=1,a.sync=0}),b.upsert(c).then(function(){console.log("mark delete"),a()})})})},getUnsyncedTracks:function(){return a(function(a,c){b.openStore("nowplaying",function(b){var c=b.query();c.$index("sync"),c.$eq(0),b.eachWhere(c).then(function(b){a(b)})})})}},e.prototype={constructor:e,insert:function(a){b.openStore("starred",function(b){Array.isArray(a)?_.each(a,function(a){b.insert(a)}):b.insert(a)})},upsert:function(a){b.openStore("starred",function(b){Array.isArray(a)?_.each(a,function(a){b.upsert(a)}):b.upsert(a)})},"delete":function(a){b.openStore("starred",function(b){Array.isArray(a)?_.each(a,function(a){b["delete"](a)}):b["delete"](a)})},getById:function(c){return a(function(a,d){b.openStore("starred",function(b){b.find(c).then(function(b){a(b)})})})},getTracks:function(){return a(function(a,c){b.openStore("starred",function(b){var c=b.query();c.$index("deleted"),c.$eq(0),b.eachWhere(c).then(function(b){a(_.sortBy(b,"order").reverse())})})})},getUnsyncedTracks:function(){return a(function(a,c){b.openStore("starred",function(b){var c=b.query();c.$index("sync"),c.$eq(0),b.eachWhere(c).then(function(b){a(b)})})})}},{getStorageInstance:f}}angular.module("soundCloudify").service("StorageService",a),a.$inject=["$q","$indexedDB"]}(),function(){"use strict";function a(a){function b(a){u=a}function c(a){r=a}function d(a){s=a}function e(a){t=a}function f(a){v=a}function g(a){w=a}function h(a){}function i(){}function j(){}function k(){}function l(){}function m(){}function n(a){}function o(a){}function p(){}function q(a){}var r,s,t,u,v,w;return{registerErrorHandler:b,registerTimeUpdateHandler:c,registerEndedHandler:d,registerTrackChangedFromBackgroundHandler:e,registerLastFmInvalidHandler:f,registerLastFmScrobbledHandler:g,sendPlayMessage:h,sendNextMessage:i,sendPrevMessage:j,sendPauseMessage:k,sendClearMessage:l,sendResumeMessage:m,sendSeekMessage:n,sendVolumeMessage:o,sendLastFmAuthenticationMessage:p,sendManualScrobbleMessage:q}}angular.module("soundCloudify").factory("Messaging",a),a.$inject=["$rootScope"]}(),function(){"use strict";function a(a,b,c,d,e,f){
function g(){return e(function(a,c){if(k.length)a(k);else{var d={limit:10,offset:0,linked_partitioning:1,client_id:b},e=window.ServiceHelpers.buildUrl(l+"/explore/categories",d);f.request(e).then(function(b){k=b.music||[],a(k),localStorage.setItem("charts",JSON.stringify(k))})}})}function h(a,c){var e={limit:c.limit,offset:c.skip,linked_partitioning:1,client_id:b},g=window.ServiceHelpers.buildUrl(l+"/explore/"+a,e),h=function(a){return a&&a.tracks?{tracks:d.adaptMultiple(a.tracks,"sc")}:[]};return f.request(g,h)}function i(b){return e(function(d,e){if(m.length){var f=angular.copy(m).splice(b.skip,b.limit);j(f,d,e)}else a({url:c+"/reddit",method:"GET"}).success(function(a){m=a;var c=angular.copy(m).splice(b.skip,b.limit);j(c,d,e)}).error(function(){e()})})}function j(b,c,e){var f=["id","snippet","statistics","status"],g=["items/id","items/snippet/title","items/snippet/thumbnails","items/statistics/viewCount","items/statistics/likeCount","items/status/embeddable"],h={key:"AIzaSyDGbUJxAkFnaJqlTD4NwDmzWxXAk55gFh4",type:"video",maxResults:b.length,part:f.join(","),fields:g.join(","),id:b.join(",")};a({url:"https://www.googleapis.com/youtube/v3/videos",method:"GET",params:h,transformResponse:ServiceHelpers.appendTransform(a.defaults.transformResponse,function(a){return a&&a.items?{tracks:d.adaptMultiple(a.items,"yt")}:[]})}).success(function(a){c(a)}).error(function(){e()})}var k=JSON.parse(localStorage.getItem("charts"))||[],l="https://api-v2.soundcloud.com",m=[];return{getList:g,getTracks:h,getRedditHot:i}}angular.module("soundCloudify").service("Category",a),a.$inject=["$http","CLIENT_ID","API_ENDPOINT","TrackAdapter","$q","YahooProxy"]}(),function(){"use strict";function a(a,b,c,d,e){function f(a,c){return d(function(d,f){var g={q:a,limit:c.limit,offset:c.skip,linked_partitioning:1,client_id:b},i=window.ServiceHelpers.buildUrl("https://api-v2.soundcloud.com/search/tracks",g);e.request(i,h).then(function(a){d(a)})})}function g(b,e){var f=d.defer(),g={key:"AIzaSyDGbUJxAkFnaJqlTD4NwDmzWxXAk55gFh4",type:"video",maxResults:e.limit,pageToken:e.nextPageToken,part:"id",q:b},h="";return a({url:"https://www.googleapis.com/youtube/v3/search",method:"GET",params:g}).success(function(b){b&&b.items||f.resolve([]),h=b.nextPageToken;var d=b.items.map(function(a){return a.id.videoId}),g=["id","snippet","statistics","status"],i=["items/id","items/snippet/title","items/snippet/thumbnails","items/statistics/viewCount","items/statistics/likeCount","items/status/embeddable"],j={key:"AIzaSyDGbUJxAkFnaJqlTD4NwDmzWxXAk55gFh4",type:"video",maxResults:e.limit,part:g.join(","),fields:i.join(","),id:d.join(",")};a({url:"https://www.googleapis.com/youtube/v3/videos",method:"GET",params:j,transformResponse:ServiceHelpers.appendTransform(a.defaults.transformResponse,function(a){return a&&a.items?{nextPageToken:h,tracks:c.adaptMultiple(a.items,"yt")}:[]})}).success(function(a){f.resolve(a)}).error(function(){f.reject()})}).error(function(){f.reject()}),f.promise}var h=function(a){return a&&a.collection?{tracks:c.adaptMultiple(a.collection,"sc")}:[]};return{search:f,searchYoutube:g}}angular.module("soundCloudify").service("SearchService",a);a.$inject=["$http","CLIENT_ID","TrackAdapter","$q","YahooProxy"]}(),function(){function a(a,b,c,d,e,f,g){function h(a){return e.search(m,a)}function i(a){return e.searchYoutube(m,a)}function j(a){o=o.concat(a),n.filteredResults=f("filter")(o,l(n.toggle)),0===n.filteredResults.length&&1===n.soundcloudPaginator.lastPromise.$$state.status&&1===n.youtubePaginator.lastPromise.$$state.status&&(n.showNoResultMessage=!0)}function k(c){return n.showSuggestion?b.suggest(c):a(function(a,b){a([]),n.showSuggestion=!0})}function l(a){var b="";if(a)return a.soundcloud&&a.youtube?b="":a.soundcloud?b+="sc":a.youtube&&(b+="yt"),{origin:b}}var m,n=this;n.searchText=null,n.suggest=k,n.search={term:""},n.showSuggestion=!0,n.recentSearch=JSON.parse(localStorage.getItem("recentSearch"))||[];var o=[];n.toggle=JSON.parse(localStorage.getItem("toggle"))||{soundcloud:!0,youtube:!0},n.player=c,n.filteredResults=[],n.soundcloudPaginator=d.getInstance({limit:10,getFirstPage:!1,pagingFunction:h,pagingSuccess:j}),n.youtubePaginator=d.getInstance({limit:10,getFirstPage:!1,pagingFunction:i,pagingSuccess:j}),n.resetSearch=function(){m="",n.filteredResults=[]},n.recentSearchClick=function(a){n.search.term=a,n.selectedItem=a,n.showSuggestion=!1,n.getMore(!0),g.trackSearch("recent search",a)},n.getMore=function(a){if(!a||n.search.term&&n.search.term!==m){var b=angular.copy(n.recentSearch);a?(o=[],n.filteredResults=[],n.showNoResultMessage=!1,n.soundcloudPaginator.reset(),n.youtubePaginator.reset(),b.unshift(n.search.term.trim()),n.recentSearch=_.uniq(b).slice(0,5),localStorage.setItem("recentSearch",JSON.stringify(n.recentSearch)),g.trackSearch("new search",n.search.term),m=n.search.term):g.trackSearch("get more",n.search.term),n.soundcloudPaginator.moreRows(),n.youtubePaginator.moreRows(),n.promises=[n.soundcloudPaginator.lastPromise,n.youtubePaginator.lastPromise]}},n.hasMoreRow=function(){return n.filteredResults.length&&(n.soundcloudPaginator.hasMoreRow||n.youtubePaginator.hasMoreRow)},n.onToggled=function(a,b){localStorage.setItem("toggle",JSON.stringify(a)),n.filteredResults=f("filter")(o,l(a)),a.soundcloud!==b.soundcloud&&g.trackSearch("toggle filter","soundcloud",a.soundcloud?"on":"off"),a.youtube!==b.youtube&&g.trackSearch("toggle filter","youtube",a.youtube?"on":"off")}}angular.module("soundCloudify").service("SearchSingleton",a),a.$inject=["$q","SuggestionService","CorePlayer","Paginator","SearchService","$filter","GATracker"]}(),function(){"use strict";function a(a,b,c,d,e){function f(a){var b={q:a,client:"firefox",ds:"yt"},c=window.ServiceHelpers.buildUrl("http://suggestqueries.google.com/complete/search",b),d=function(a){return a&&a.json&&a.json[1]?a.json[1].json.map(function(a){return{value:a,display:a}}):[]};return e.request(c,d)}return{suggest:f}}angular.module("soundCloudify").service("SuggestionService",a),a.$inject=["$http","CLIENT_ID","TrackAdapter","$q","YahooProxy"]}(),function(){"use strict";function a(a,c,d,e,f,g,h){function i(){l().then(function(a){var b=_.map(a,function(a){return a.uuid});r(b)})}function j(){return t}function k(a){return v.getById(a)}function l(a){return v.getTracks()}function m(a,b){return c(function(c,d){a=angular.copy(a),a.uuid=window.ServiceHelpers.ID(),a.sync=0,a.deleted=0;var e;e=b&&t.trackIds.length>=1?t.trackIds[b]:t.trackIds[0],e?v.getById(e).then(function(d){if(a.order=d.order+1,v.insert(a),"undefined"!=typeof b){t.trackIds.splice(b,0,a.uuid);var e=_.filter(t.trackIds,function(a,c){return b>c});e.length&&v.increaseOrder(e),r(t.trackIds),g.push().then(g.bumpLastSynced),c()}else t.trackIds.unshift(a.uuid),r(t.trackIds),g.push().then(g.bumpLastSynced),c()}):(a.order=0,t.trackIds.unshift(a.uuid),v.insert(a),r(t.trackIds),g.push().then(g.bumpLastSynced),c())})}function n(a){return c(function(b,c){p(!1).then(function(){var c=_.map(a,function(b,c){return b=angular.copy(b),b.uuid=window.ServiceHelpers.ID(),b.sync=0,b.deleted=0,b.order=a.length-1-c,b});t.trackIds=_.map(c,function(a){return a.uuid}),r(t.trackIds),v.insert(c),g.push().then(g.bumpLastSynced),b()})})}function o(a){return c(function(b,c){var d=t.trackIds[a];v.getById(d).then(function(d){d||c(),d&&(t.trackIds.splice(a,1),d.deleted=1,d.sync=0,v.upsert([d])),r(t.trackIds),g.push().then(g.bumpLastSynced),b()})})}function p(a){return c(function(b,c){a="undefined"==typeof a?!0:a,v.markAllTracksAsDeleted().then(function(){t.trackIds=[],r([]),a&&g.push().then(g.bumpLastSynced),b()})})}function q(a){a&&(u=a,localStorage.setItem("playerstate",JSON.stringify(a)))}function r(a){a&&(t.trackIds=a,localStorage.setItem("nowplaying",JSON.stringify(a)))}function s(a){return u}var t={trackIds:JSON.parse(localStorage.getItem("nowplaying"))||[]},u=JSON.parse(localStorage.getItem("playerstate"))||b;u.playing=!1,u.currentTime=0;var v=h.getStorageInstance("nowplaying");return e.$on("sync.completed",function(){i()}),i(),{getTrackIds:j,getTrack:k,getTracks:l,addTrack:m,addTracks:n,removeTrack:o,removeAllTracks:p,getState:s,saveState:q}}angular.module("soundCloudify").service("NowPlaying",a);var b={currentTrack:!1,currentIndex:0,playing:!1,currentTime:0,duration:0,volume:.5,repeat:0,shuffle:!1,scrobbleEnabled:!1,scrobbled:!1,lastFmInvalid:!1};a.$inject=["$http","$q","CLIENT_ID","$rootScope","API_ENDPOINT","SyncService","StorageService"]}(),function(){"use strict";function a(a,b){if(!a)throw new Error("You have to specify a name when create a playlist");this.tracks=b||[],this.name=a,this.uuid=window.ServiceHelpers.ID(),this.sync=0,this.deleted=0}function b(b,c,d,e,f,g){function h(){b.$on("identity.confirm",function(a,b){b.identity.id&&b.identity.email&&(t=b.identity)}),b.$on("sync.completed",function(){i()}),i()}function i(){u.getAllPlaylists().then(function(a){v.items=a||[]})}function j(){return v}function k(b,d,f){return c(function(c,g){d="undefined"==typeof d?!0:d,f=f||[];var h=new a(b,f);h.order=v.items.length?v.items[0].order+1:0,v.items.unshift(h),u.insert(h),e.push().then(e.bumpLastSynced),c()})}function l(a){if("undefined"==typeof a||isNaN(a))throw new Error("Error when remove playlist: index must be specified as number");var b=m(a);b.deleted=1,b.sync=0,u.upsert(b),e.push().then(e.bumpLastSynced)}function m(a){if("undefined"==typeof a||isNaN(a))throw new Error("Error when remove playlist: index must be specified as number");return v.items[a]}function n(a,b){var c=v.items[b];if(!c)throw new Error("Error when adding track: Playlist not found.");q(a,c)}function o(a,b){if(!a)throw new Error("Error when adding tracks: Track is undefined");if(!b)throw new Error("Error when adding track: Playlist not found.");r(a,b)}function p(a,b){var c=v.items[b];if(!c)throw new Error("Error when adding track: Playlist not found.");s(a,c)}function q(a,b){return c(function(c,d){var f=angular.copy(a);f.internalId="",f.uuid=window.ServiceHelpers.ID(),f.deleted=0,f.sync=0,b.tracks.push(f),b.sync=0,u.upsert(b),e.push().then(e.bumpLastSynced)})}function r(a,b){var c=a.map(function(a){var b=angular.copy(a);return b.internalId="",b.uuid=window.ServiceHelpers.ID(),b.deleted=0,b.sync=0,b});b.tracks=b.tracks.concat(c),b.sync=0,u.upsert(b),e.push().then(e.bumpLastSynced)}function s(a,b){if("undefined"==typeof a||isNaN(a))throw new Error("Error when remove track: trackIndex must be specified as number");b.tracks[a].deleted=1,b.sync=0,u.upsert(b),e.push().then(e.bumpLastSynced)}var t,u=g.getStorageInstance("playlist"),v={items:[]};return h(),{getList:j,newPlaylist:k,removePlaylist:l,getPlaylist:m,addTrackToPlaylist:n,addTracksToPlaylist:o,removeTrackFromPlaylist:p}}angular.module("soundCloudify").service("PlaylistService",b),b.$inject=["$rootScope","$q","$http","SyncService","API_ENDPOINT","StorageService"]}(),function(){"use strict";function a(a,b,c){function d(){k.getTracks().then(function(b){j=_.map(b,function(a){return a.id}),a.$broadcast("starredList.ready")})}function e(){return k.getTracks()}function f(){return j.length}function g(a){i(a)||(j.push(a.id),a.internalId="",a.sync=0,a["delete"]=0,k.insert(a),c.push().then(c.bumpLastSynced))}function h(a){var b=a.id,d=j.indexOf(a.id);d>-1&&(j.splice(d,1),k.getById(b).then(function(a){a.sync?(a.sync=0,a.deleted=1,k.upsert(a),c.push().then(c.bumpLastSynced)):k["delete"](b)}))}function i(a){return j.indexOf(a.id)>-1}var j=[],k=b.getStorageInstance("starred");return a.$on("sync.completed",function(){d()}),{getTracks:e,getLength:f,starTrack:g,unstarTrack:h,isTrackStarred:i}}angular.module("soundCloudify").service("StarService",a),a.$inject=["$rootScope","StorageService","SyncService"]}(),function(){"use strict";function a(a){function b(b,c){if(!b)throw new Error("Can not adapt null");var d={};return b.origin===f||c===f?(d.id=b.id,d.title=b.snippet.title,d.artworkUrl=b.snippet.thumbnails["default"].url||e,d.streamUrl=null,d.user="youtube",d.likeCount=b.statistics.likeCount,d.dislikeCount=null,d.viewCount=b.statistics.viewCount,d.origin=f,d.originalUrl="https://www.youtube.com/watch?v="+b.id+"&source=soundcloudify"):(d.id=b.id,d.title=b.title,d.artworkUrl=b.artwork_url||b.user.avatar_url||e,d.streamUrl=b.stream_url,d.user=b.user.username,d.likeCount=b.likes_count,d.dislikeCount=null,d.viewCount=b.playback_count,d.origin=g,d.originalUrl=b.permalink_url+"?source=soundcloudify"),d.uuid=window.ServiceHelpers.ID(),d.starred=a.isTrackStarred(d),d}function c(a,c){return _.filter(_.map(a,function(a){return a?b(a,c):void 0}),function(a){return null!==a&&"undefined"!=typeof a})}function d(b){return _.filter(_.map(b,function(b){return b?(b.starred=a.isTrackStarred(b),b):void 0}),function(a){return null!==a&&"undefined"!=typeof a})}var e="images/artwork-default.jpg",f="yt",g="sc";return{adapt:b,adaptMultiple:c,decorateStar:d}}angular.module("soundCloudify").service("TrackAdapter",a),a.$inject=["StarService"]}(),function(){"use strict";function a(a){function b(b){a.ga&&b&&a.ga("send","pageview",{page:b})}function c(b,c,d){a.ga&&a.ga("send","event","search",b,c,d)}function d(b,c,d){a.ga&&a.ga("send","event","discovery",b,c,d)}function e(b,c,d){a.ga&&a.ga("send","event","player",b,c,d)}function f(b,c,d){a.ga&&a.ga("send","event","playlist",b,c,d)}function g(b,c,d,e){a.ga&&a.ga("send","event",b,c,d,e)}return{trackPageView:b,trackSearch:c,trackDiscovery:d,trackPlayer:e,trackPlaylist:f,trackCustomEvent:g}}angular.module("soundCloudify").service("GATracker",a),a.$inject=["$window"]}(),function(){"use strict";function a(a,b){function c(c){if(l){var d={api_key:i,token:l,method:"auth.getSession",format:"json"};d.api_sig=g(d),a({url:h,method:"GET",params:d}).success(function(a){a.session&&a.session.key?(console.log("session key: "+a.session.key),k=a.session.key,l="",localStorage.setItem("lastfm.sessionKey",a.session.key),localStorage.setItem("lastfm.token",""),b.sendLastFmAuthenticationMessage(),c&&c.apply()):4===a.error?e():(a.error=14)&&f(l)}).error(function(){console.log("LastFMAuthentication._requestToken: error")})}else e()}function d(){return!!k}function e(){var b={method:"auth.getToken",api_key:i,format:"json"};a({url:h,method:"GET",params:b}).success(function(a){a.token?(console.log("token: "+a.token),localStorage.setItem("lastfm.token",a.token),l=a.token,f(a.token)):console.log("LastFM.auth: no token key found")}).error(function(){console.log("LastFMAuthentication._requestToken: error")})}function f(a){var b="https://www.last.fm/api/auth/?api_key="+i+"&token="+a;chrome.tabs.create({active:!0,url:b})}function g(a){var b=[],c="";for(var d in a)a.hasOwnProperty(d)&&b.push(d);b.sort();for(var e=0;e<b.length;e++)"format"!=b[e]&&"callback"!=b[e]&&(c=c+b[e]+a[b[e]]);return md5(c+j)}var h="https://ws.audioscrobbler.com/2.0/",i="270d7aec2d7de22c88d90f36c66c9a1a",j="c8a7d4cbfba61e6b777220878bfa8cc1",k=localStorage.getItem("lastfm.sessionKey"),l=localStorage.getItem("lastfm.token");return{auth:c,isAuth:d}}angular.module("soundCloudify").service("LastFMAuthentication",a),a.$inject=["$http","Messaging"]}(),function(){"use strict";function a(a,b){function c(c,e){var f={url:d,method:"GET",params:{q:'select * from json where url="'+c+'"',format:"json"}};return f.transformResponse=ServiceHelpers.appendTransform(a.defaults.transformResponse,function(a){var b;try{b=a.query.results.json}catch(c){}return b}),e&&(f.transformResponse=ServiceHelpers.appendTransform(f.transformResponse,e)),b(function(b,c){a(f).success(function(a){b(a)}).error(function(){c()})})}var d="http://query.yahooapis.com/v1/public/yql";return{request:c}}angular.module("soundCloudify").service("YahooProxy",a),a.$inject=["$http","$q"]}(),function(){"use strict";function a(a){var b,c=a.get("$rootScope"),d=a.get("API_ENDPOINT");c.$on("identity.confirm",function(a,c){c.identity.id&&c.identity.email&&(b=c.identity)});var b;return{request:function(a){return b?(a&&a.url&&0===a.url.indexOf(d)&&(a.headers.uid=b.id),a):a}}}angular.module("soundCloudify").service("HttpRequestInterceptor",a),a.$inject=["$injector"]}(),function(){"use strict";function a(a,b,c,d,e,f){function g(){a.$on("identity.confirm",function(a,b){b.identity.id&&(l=b.identity,console.log("let sync!"),d(function(){h()},1e3))})}function h(){a.$broadcast("sync.start"),i().then(j).then(k)}function i(){return q?(console.log("SyncService::pull() is in progress"),void reject()):l?(console.log("SyncService::pull()"),q=!0,b(function(a,b){var d=e+"/data";m&&(d+="?from="+m),c.get(d).success(function(b){_.each(b.playlists,function(a,b){a.deleted?n["delete"](a.uuid):(a.uuid||(a.uuid=window.ServiceHelpers.ID()),a.sync=1,n.upsert(a))}),b.nowplaying.tracks&&(_.each(b.nowplaying.tracks,function(a){a.sync=1}),o.upsert(b.nowplaying.tracks)),b.starred.tracks&&(_.each(b.starred.tracks,function(a){a.sync=1}),p.upsert(b.starred.tracks)),a(b.time),q=!0})})):(console.log("SyncService::pull() no user"),void reject())}function j(a){return b(function(d,f){return r?(console.log("SyncService::push() is in progress"),void f()):l?(console.log("SyncService::push()"),r=!0,void b.all({unsyncedPlaylists:n.getUnsyncedPlaylists(),unsyncedNowPlayingTracks:o.getUnsyncedTracks(),unsyncedStarredTracks:p.getUnsyncedTracks()}).then(function(g){var h=g.unsyncedPlaylists,i=g.unsyncedNowPlayingTracks,j=g.unsyncedStarredTracks,k=[];_.each(h,function(a){if(a.id)if(a.deleted)a.id&&a.deleted&&k.push(c({url:e+"/playlist/"+a.id,method:"DELETE"}));else{var b=_.filter(a.tracks,function(a){return!a.internalId&&!a.deleted}),d=_.filter(a.tracks,function(a){return a.internalId&&a.deleted});k.push(c({url:e+"/playlist/"+a.id,method:"PUT",data:{added:b,removed:_.map(d,function(a){return a.internalId})}}))}else k.push(c({url:e+"/playlist",method:"POST",data:a}))});var l=_.filter(i,function(a){return!a.internalId});l=_.sortBy(l,function(a){return a.order});var m=_.filter(i,function(a){return a.internalId&&1===a.deleted});k.push(l.length||m.length?c({url:e+"/nowplaying",method:"PUT",data:{added:l,removed:_.map(m,function(a){return a.internalId})}}):b(function(a,b){a("nowplaying")}));var q=_.filter(j,function(a){return!a.internalId});q=_.sortBy(q,function(a){return a.order});var s=_.filter(j,function(a){return a.internalId&&1===a.deleted});k.push(q.length||s.length?c({url:e+"/star",method:"PUT",data:{added:q,removed:_.map(s,function(a){return a.internalId})}}):b(function(a,b){a("star")})),b.all(k).then(function(b){var c=b.splice(b.length-1,1)[0],e=b.splice(b.length-1,1)[0],f=b;if(_.each(f,function(b,c){var d=h[c];d&&b.data.id?(d.id=b.data.id,d.updated=b.data.updated,d.sync=1,n.upsert(d),a=b.data.time):d&&b.data.length?(_.each(b.data[0],function(a,b){var c=_.findWhere(d.tracks,{uuid:a.uuid});c&&(c.internalId=a.internalId)}),d.tracks=_.filter(d.tracks,function(a){return!a.deleted}),d.sync=1,n.upsert(d),a=b.data[2].time):d.deleted&&(n["delete"](d.uuid),a=b.data.time)}),e&&e.data&&e.data.length){_.each(e.data[0],function(a,b){var c=l[b];c.internalId=a.internalId,c.sync=1}),o.upsert(l);var g=_.map(m,function(a){return a.uuid});o["delete"](g),a=e.data[2].time}if(c&&c.data&&c.data.length){_.each(c.data[0],function(a,b){var c=q[b];c.internalId=a.internalId,c.sync=1}),p.upsert(q);var i=_.map(s,function(a){return a.uuid});p["delete"](i),a=c.data[2].time}r=!1,d(a)},function(){r=!1,f()})})):(console.log("SyncService::push() no user"),void f())})}function k(b){b&&(localStorage.setItem("lastSynced",b),a.$broadcast("sync.completed"))}var l,m=localStorage.getItem("lastSynced"),n=f.getStorageInstance("playlist"),o=f.getStorageInstance("nowplaying"),p=f.getStorageInstance("starred"),q=!1,r=!1;return{init:g,sync:h,pull:i,push:j,bumpLastSynced:k}}angular.module("soundCloudify").service("SyncService",a);a.$inject=["$rootScope","$q","$http","$timeout","API_ENDPOINT","StorageService"]}(),function(){"use strict";var a=angular.module("soundCloudify");a.service("CorePlayer",["$rootScope","$window","$mdToast","Messaging","NowPlaying","CLIENT_ID","GATracker","LastFMAuthentication","SoundCloudPlayer","YouTubePlayer",function(a,b,c,d,e,f,g,h,i,j){function k(a,b){var c=null;return function(){var d=this,e=arguments;clearTimeout(c),c=setTimeout(function(){a.apply(d,e)},b)}}var l="yt",m=this;this.nowplaying=e.getTrackIds(),this.state=e.getState(),this.startTimestamp=null,this.activePlayer=null,this.add=function(a,b){b=b||!0,a&&e.addTrack(a).then(function(){b&&m.play(0)})},this.playNext=function(a){a&&e.addTrack(a,this.state.currentIndex+1)},this.playAll=function(a){e.addTracks(a).then(function(){angular.extend(m.state,{currentTrack:!1,currentIndex:0,playing:!1,currentTime:0,duration:0}),m.play(0)})},this.remove=function(a){e.removeTrack(a).then(function(){m.state.currentIndex===a?m.play(a):a<m.state.currentIndex&&m.state.currentIndex--,e.saveState(m.state)})},this.clear=function(){e.removeAllTracks().then(function(){angular.extend(m.state,{currentTrack:null,currentIndex:0,playing:!1,currentTime:0,duration:0}),d.sendClearMessage(),e.saveState(m.state)})},this.play=function(a){a=a||0;var b=this.nowplaying.trackIds[a];if(!b)throw"No track found for playing, index="+a;b&&e.getTrack(b).then(function(b){m.state.playing=!0,m.state.currentTime=0,m.state.duration=0,m.state.currentTrack=b,m.state.currentIndex=a,e.saveState(m.state),b.origin===l?(i.clear(),j.play(b),m.activePlayer=j):(j.clear(),i.play(b),m.activePlayer=i),m.startTimestamp=Math.floor(Date.now()/1e3)})},this.pause=function(){this.state.playing=!1,e.saveState(m.state),this.activePlayer&&this.activePlayer.pause()},this.resume=function(){return this.state.playing=!0,e.saveState(this.state),this.activePlayer?void this.activePlayer.resume():void this.play(this.state.currentIndex)},this.stop=function(){this.state.playing=!1,this.state.currentTime=0,e.saveState(this.state),this.activePlayer&&this.activePlayer.stop()},this.playPause=function(a){return"undefined"!=typeof a?void(a===this.state.currentIndex&&this.activePlayer?this.state.playing?this.pause():this.resume():this.play(a)):void(this.state.playing?this.pause():this.resume())},this.next=function(){var a;this.state.shuffle?a=Utils.random(0,this.tracks.length-1):(a=this.state.currentIndex+1,a>=this.tracks.length&&(a=0)),this.play(a)},this.previous=function(){var a=this.state.currentIndex,b=a-1;0>b&&(b=this.tracks.length-1),this.play(b)},this.seek=function(a){this.state.currentTime=a*this.state.duration,this.activePlayer&&this.activePlayer.seek(a)},this.updateState=function(a){this.state.currentTrack||(this.state.currentTrack=a.track,this.state.playing=!0),this.state.currentTime=a.currentTime,this.state.duration=a.duration},this.isPlaying=function(a){return this.state.currentTrack?this.state.currentTrack.id===a:!1};var n=k(function(){e.saveState(m.state)},500);this.setVolume=function(a){this.state.volume=a,i.setVolume(a),j.setVolume(a),n()},this.toggleRepeat=function(){this.state.repeat=0===this.state.repeat?1:1===this.state.repeat?2:0,e.saveState(this.state),g.trackPlayer("toggle repeat",1===this.state.repeat?"all":2===this.state.repeat?"one":"none")},this.toggleShuffle=function(){this.state.shuffle=!this.state.shuffle,e.saveState(this.state),g.trackPlayer("toggle shuffle",this.state.shuffle?"on":"off")},this.toggleScrobble=function(){var a=this;h.isAuth()?a.state.scrobble=!a.state.scrobble:h.auth(function(){a.state.scrobble=!0}),e.saveState(a.state),g.trackPlayer("toggle scrobble",this.state.scrobble?"on":"off")},this.sendManualScrobble=function(a){d.sendManualScrobbleMessage(a),this.tracks[this.state.currentIndex].manualTrack=a.track,this.tracks[this.state.currentIndex].manualArtist=a.artist,e.saveList(this.tracks)},this.markCurrentTrackError=function(){this.state.currentTrack.error=!0,this.tracks[this.state.currentIndex].error=!0,e.saveState(this.state),e.saveList(this.tracks),g.trackPlayer("track error")},a.$on("player.timeupdate",function(b,c){a.$apply(function(){m.updateState.call(m,c)})}),a.$on("player.error",function(){c.show({templateUrl:"scripts/views/toastError.html",hideDelay:1e3,position:"bottom right",parent:angular.element(document.querySelector("#tab-content"))}),m.markCurrentTrackError()}),a.$on("player.ended",function(){a.$apply(function(){0===m.state.repeat?m.state.currentIndex===m.tracks.length-1?(m.stop(),m.seek(0),currentPort.postMessage({message:"scd.ended"})):m.next.call(m):1===m.state.repeat?m.next.call(m):m.replay.call(m)})})}])}(),function(){"use strict";function a(a,b){var c=this;this.audio=document.createElement("audio"),this.audio.volume=.5,this.audio.addEventListener("timeupdate",function(){a.$broadcast("player.timeupdate",{currentTime:c.audio.currentTime,duration:c.audio.duration})},!1),this.audio.addEventListener("ended",function(){a.$broadcast("player.ended")},!1),this.audio.addEventListener("error",function(){a.$broadcast("player.error")},!1),this.play=function(a){var c=a.streamUrl+"?client_id="+b;c===this.audio.src?this.replay():(this.audio.src=c,this.audio.play())},this.resume=function(){this.audio.play()},this.pause=function(){this.audio.pause()},this.stop=function(){this.audio.pause(),this.audio.currentTime=0},this.replay=function(){this.stop(),this.resume()},this.seek=function(a){return this.audio.readyState?void(this.audio.currentTime=a*this.audio.duration):!1},this.clear=function(){this.audio.pause(),this.audio.src="",this.audio.removeAttribute("src")},this.setVolume=function(a){this.audio.volume=a}}angular.module("soundCloudify").service("SoundCloudPlayer",a),a.$inject=["$rootScope","CLIENT_ID"]}(),function(){"use strict";function a(a,b,c){function d(b){switch(clearTimeout(f),b.data){case YT.PlayerState.PLAYING:f=setInterval(function(){a.$broadcast("player.timeupdate",{currentTime:g.player.getCurrentTime(),duration:g.player.getDuration()})},1e3);break;case YT.PlayerState.ENDED:a.$broadcast("player.ended");break;case YT.PlayerState.PAUSED:break;case YT.PlayerState.BUFFERING:break;case YT.PlayerState.CUED:}}function e(){a.$broadcast("player.error")}this.player=null,this.playerReady=!1;var f,g=this,h=c[0].createElement("script");h.src="https://www.youtube.com/iframe_api";var i=c[0].getElementsByTagName("script")[0];i.parentNode.insertBefore(h,i),window.onYouTubeIframeAPIReady=function(){g.player=new YT.Player("invisible-player",{height:"390",width:"640",videoId:"J1Ol6M0d9sg",events:{onReady:onPlayerReady,onStateChange:d,onError:e}})},window.onPlayerReady=function(a){g.playerReady=!0},this.play=function(a){this.playerReady&&this.player.loadVideoById({videoId:a.id})},this.resume=function(){this.player.playVideo()},this.pause=function(){this.player.pauseVideo()},this.stop=function(){this.player.stopVideo()},this.replay=function(){this.player.seekTo(0)},this.seek=function(a){this.player.seekTo(a*this.player.getDuration())},this.clear=function(){this.stop(),this.player.clearVideo()},this.setVolume=function(a){this.player&&this.player.setVolume&&(this.player.setVolume(100*a),this.player.isMuted()&&this.player.unMute())}}angular.module("soundCloudify").service("YouTubePlayer",a),a.$inject=["$rootScope","CLIENT_ID","$document"]}();